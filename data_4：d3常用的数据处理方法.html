<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>data_4：d3常用的数据处理方法</title>
</head>

<body>

    <div class="code">var array = [3, 2, 11, 7, 6, 4, 10, 8, 15]</div>

    <div>返回 - 最小值 - d3.min => <span id="min"></span></div>
    <div>返回 - 最大值 - d3.max => <span id="max"></span></div>
    <div>返回 - 最大值和最小值 - d3.extent => <span id="extent"></span></div>
    <div>返回 - 总和 - d3.sum => <span id="sum"></span></div>
    <div>返回 - 给定数组元素的 中位数 - d3.median => <span id="median"></span></div>
    <div>返回 - 给定数组元素的均值 或 平均值 - d3.mean => <span id="mean"></span></div>
    <div>返回 - 筛选后-升序操作 - array.sort(d3.ascending) => <span id="asc"></span></div>
    <div>返回 - 筛选后-降序序操作 - array.sort(d3.descending) => <span id="desc"></span></div>

    <!-- ♦d3.quantile:这个函数计算排序数组的分位数(分位数是一个概率论的概念，给定 0<p<l,随机变量X上的p分位数指同时满足下列两个条件的数x： P { X <= x } >= 1 -p和P { X>=x } >=p)。本例中，数组的0.25分位数为4o
♦d3.bisect：该函数返回排序数组的一个插入点，这个插入点的左边的元素都小于或 者等于指定的元素，而右边的元素均大于指定的元素。本例中，bisect(array, 6)返 回4。
♦d3.nest：该函数可以用于将一维数组结构的数据转换为树状嵌套结构的数据。这 种转换可能特别适用于某种可视化场合。如需对此函数进行配置，则只需在nest 函数后级联调用key函数即可。请参见代码中的第A行和第B行。 -->
<!-- 我们可以使用多个key函数创建多层次的嵌套 -->

    <div>d3.quantile(array.sort(d3.ascending), 0.25) => <span id="quantile"></span></div>
    <div>d3.bisect(array.sort(d3.ascending), 6) => <span id="bisect"></span></div>

    <div class="code">
        <pre>
    var records = [
      {date: "2011-11-14T16:17:54Z", quantity: 2, total: 190, tip: 100, type: "tab"},
      {date: "2011-11-14T16:20:19Z", quantity: 2, total: 190, tip: 100, type: "tab"},
      {date: "2011-11-14T16:28:54Z", quantity: 1, total: 300, tip: 200, type: "visa"},
      {date: "2011-11-14T16:30:43Z", quantity: 2, total: 90, tip: 0, type: "tab"},
      {date: "2011-11-14T16:48:46Z", quantity: 2, total: 90, tip: 0, type: "tab"},
      {date: "2011-11-14T16:53:41Z", quantity: 2, total: 90, tip: 0, type: "tab"},
      {date: "2011-11-14T16:54:06Z", quantity: 1, total: 100, tip: 0, type: "cash"},
      {date: "2011-11-14T16:58:03Z", quantity: 2, total: 90, tip: 0, type: "tab"},
      {date: "2011-11-14T17:07:21Z", quantity: 2, total: 90, tip: 0, type: "tab"},
      {date: "2011-11-14T17:22:59Z", quantity: 2, total: 90, tip: 0, type: "tab"},
      {date: "2011-11-14T17:25:45Z", quantity: 2, total: 200, tip: 0, type: "cash"},
      {date: "2011-11-14T17:29:52Z", quantity: 1, total: 200, tip: 100, type: "visa"}
    ];

    d3.nest()
            .key(function(d){return d.type;})
            .key(function(d){return d.tip;})
            .entries(records) =>
</pre>
    </div>

    <div>
        <pre id="nest"></pre>
    </div>


    <script type="text/javascript">
        var array = [3, 2, 11, 7, 6, 4, 10, 8, 15];

        d3.select("#min").text(d3.min(array));
        d3.select("#max").text(d3.max(array));
        d3.select("#extent").text(d3.extent(array));
        d3.select("#sum").text(d3.sum(array));
        d3.select("#median").text(d3.median(array));
        d3.select("#mean").text(d3.mean(array));
        d3.select("#asc").text(array.sort(d3.ascending));
        d3.select("#desc").text(array.sort(d3.descending));
        d3.select("#quantile").text(
            d3.quantile(array.sort(d3.ascending), 0.25)
        );
        d3.select("#bisect").text(
            d3.bisect(array.sort(d3.ascending), 6)
        );

        var records = [
            { quantity: 2, total: 190, tip: 100, type: "tab" },
            { quantity: 2, total: 190, tip: 100, type: "tab" },
            { quantity: 1, total: 300, tip: 200, type: "visa" },
            { quantity: 2, total: 90, tip: 0, type: "tab" },
            { quantity: 2, total: 90, tip: 0, type: "tab" },
            { quantity: 2, total: 90, tip: 0, type: "tab" },
            { quantity: 1, total: 100, tip: 0, type: "cash" },
            { quantity: 2, total: 90, tip: 0, type: "tab" },
            { quantity: 2, total: 90, tip: 0, type: "tab" },
            { quantity: 2, total: 90, tip: 0, type: "tab" },
            { quantity: 2, total: 200, tip: 0, type: "cash" },
            { quantity: 1, total: 200, tip: 100, type: "visa" }
        ];

        var nest = d3.nest()
            .key(function (d) { // <- A
                return d.type;
            })
            .key(function (d) { // <- B
                return d.tip;
            })
            .entries(records); // <- C

        d3.select("#nest").html(printNest(nest, ""));

        function printNest(nest, out, i) {
            if (i === undefined) i = 0;

            var tab = ""; for (var j = 0; j < i; ++j) tab += " ";

            nest.forEach(function (e) {
                if (e.key)
                    out += tab + e.key + "<br>";
                else
                    out += tab + printObject(e) + "<br>";

                if (e.values)
                    out = printNest(e.values, out, ++i);
                else
                    return out;
            });

            return out;
        }

        function printObject(obj) {
            var s = "{";
            for (var f in obj) {
                s += f + ": " + obj[f] + ", ";
            }
            s += "}";
            return s;
        }
    </script>

</body>

</html>